<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Jie Xu &amp; Dominik C. Hezel">
<meta name="dcterms.date" content="2023-01-25">

<title>Boron LA-ICP-MS Data Reduction Program</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="Boron_Documentation_files/libs/clipboard/clipboard.min.js"></script>
<script src="Boron_Documentation_files/libs/quarto-html/quarto.js"></script>
<script src="Boron_Documentation_files/libs/quarto-html/popper.min.js"></script>
<script src="Boron_Documentation_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Boron_Documentation_files/libs/quarto-html/anchor.min.js"></script>
<link href="Boron_Documentation_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Boron_Documentation_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Boron_Documentation_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Boron_Documentation_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Boron_Documentation_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="toc-section-number">1</span>  Introduction</a></li>
  <li><a href="#how-to-use-the-progame" id="toc-how-to-use-the-progame" class="nav-link" data-scroll-target="#how-to-use-the-progame"><span class="toc-section-number">2</span>  How to use the Progame</a></li>
  <li><a href="#input-file-requirements" id="toc-input-file-requirements" class="nav-link" data-scroll-target="#input-file-requirements"><span class="toc-section-number">3</span>  Input File Requirements</a></li>
  <li><a href="#description-of-the-python-code" id="toc-description-of-the-python-code" class="nav-link" data-scroll-target="#description-of-the-python-code"><span class="toc-section-number">4</span>  Description of the Python Code</a>
  <ul class="collapse">
  <li><a href="#explaining-the-functions" id="toc-explaining-the-functions" class="nav-link" data-scroll-target="#explaining-the-functions"><span class="toc-section-number">4.1</span>  Explaining the Functions</a></li>
  <li><a href="#explaining-the-main-body-of-the-code" id="toc-explaining-the-main-body-of-the-code" class="nav-link" data-scroll-target="#explaining-the-main-body-of-the-code"><span class="toc-section-number">4.2</span>  Explaining the Main Body of the Code</a></li>
  </ul></li>
  <li><a href="#explain-the-output" id="toc-explain-the-output" class="nav-link" data-scroll-target="#explain-the-output"><span class="toc-section-number">5</span>  Explain the Output</a></li>
  <li><a href="#testing" id="toc-testing" class="nav-link" data-scroll-target="#testing"><span class="toc-section-number">6</span>  Testing</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Boron LA-ICP-MS Data Reduction Program</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Jie Xu &amp; Dominik C. Hezel </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">January 25, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="introduction" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="introduction"><span class="header-section-number">1</span> Introduction</h2>
<p>This program is capable of:</p>
<ul>
<li>Read multiple .exp data files</li>
<li>Read additional .csv files</li>
<li>Outlier rejection</li>
<li>Background correction</li>
<li>Intra-sequence Instrumental drift correction</li>
<li>Ablation volume dependent B concentration offset correction</li>
<li>Combination of calculation results, laser parameters and trace elements results</li>
<li>Ready to use final data table</li>
</ul>
</section>
<section id="how-to-use-the-progame" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="how-to-use-the-progame"><span class="header-section-number">2</span> How to use the Progame</h2>
<ol type="1">
<li><p>Upload data files from Neptune: click the ‘Browse files’ botton, then, use ‘command A’ to choose all ‘.exp’ data files required from Neptune.</p></li>
<li><p>Set up parameters for isotopic data: (1). drag slider to choose bacground and signal area. Orange color zone represents background, and blue color zone is signal area. (2). set your outlier factor: with smaller number, more data will be cut as outlier, which can be observed from red spots. (3). set the bulge factor for 11B factor: this is related with bulge correction from 10B, 0.6 here as a factor is defined by Dr.&nbsp;Axel Gerdes. (4). choose your standard for intra-sequence instrumental drift correction: the name, the ‘A/B/C/D’ inside the name of standard, the regression level.</p></li>
<li><p>Upload your log fuke from laser: click the ‘Browse files’ botton and choose your laser file. (have a check if it is matched with isotopic data.)</p></li>
</ol>
<p>Choose the folder which have all datafiles. Use bacground_sub function to correct the background for all datafiles; 2. Choose one sample as standard sample to calculate 11B/10B, and 11B Intra-sequence Instrumental drift with regression function. Correction factor from each datafile will be returned. 3. Multiply 11B/10B correction factor and calculate Boron isotopic values and erros. 4. Mapping calculate Boron isotopic values and laser parameters. 5. Multiply 11B correction factor and the volume factor to 11B signal for B concentrations. 6. Use prepare_trace function to prepare trace elements data from Element XR and merged with upper results.</p>
</section>
<section id="input-file-requirements" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="input-file-requirements"><span class="header-section-number">3</span> Input File Requirements</h2>
<p>A brief description how the input file should look like, how data files should be labelled, etc. Screenshots would be helpful, and we should have a demo dataset in the repo</p>
<p>The raw data file should be a folder composed by .exp or .csv files and the name of these files should in a format of sequence number and sample type, e.g.&nbsp;‘001-A’, ‘002-B’.</p>
<p>Each file should at least have 4 columns for calculation: ‘9.9’, ‘10B’, ’10.2’, ‘11B’. Titles of data columns are in the 23th row. So, data starts in the 24th row and ends roughly in the 200th row, depends on the number of measuring cycles. Data in each column is sorted by time or cycle, the former part is noise, then, signal. Data increases rapidly from noise to signal (fig.).</p>
</section>
<section id="description-of-the-python-code" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="description-of-the-python-code"><span class="header-section-number">4</span> Description of the Python Code</h2>
<p>Required packages</p>
<div class="cell" data-execution_count="1">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> streamlit <span class="im">as</span> st</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statistics <span class="im">as</span> stt</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy <span class="im">import</span> stats</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.optimize <span class="im">import</span> curve_fit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Uploading files, multiple files and only .exp files are allowed.</p>
<div class="cell" data-execution_count="2">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>uploaded_files <span class="op">=</span> st.file_uploader(<span class="st">'upload files'</span>, <span class="bu">type</span><span class="op">=</span>[<span class="st">'.exp'</span>], accept_multiple_files<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>2023-02-27 07:11:49.591 
  Warning: to view this Streamlit app on a browser, run it with the following
  command:

    streamlit run /opt/anaconda3/lib/python3.8/site-packages/ipykernel_launcher.py [ARGUMENTS]</code></pre>
</div>
</div>
<section id="explaining-the-functions" class="level3" data-number="4.1">
<h3 data-number="4.1" class="anchored" data-anchor-id="explaining-the-functions"><span class="header-section-number">4.1</span> Explaining the Functions</h3>
<p>-&gt; Include here explanations of what the functions do to the data, e.g., why the regression, why higher orders: or – why the subtraction of the backgrounds, what two backgrounds exist: the ‘normal’ one, and one from an unknown source</p>
<p><strong>dirFiles(fDir, ending)</strong></p>
<p>In the raw data folder, there are hundreds of datafiles in different type. dirFiles helps to read all names of datafiles in working folder-fDir, ending is related with the type of datafile which we are gonna work on, can be ‘exp’ or ‘csv’.</p>
<p><strong>def selSmpType(dataFiles)</strong></p>
<p>get the number in the name of datafile. The number represents its sequence number, which will be used for Instrumental drift correction.</p>
<div class="cell" data-execution_count="3">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> selSmpType(dataFiles):</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    l <span class="op">=</span> []</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> dataFiles:    </span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>        l.append(<span class="bu">float</span>(<span class="bu">file</span>.split(<span class="st">'_'</span>)[<span class="dv">0</span>]))</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> l</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><strong>def outlierCorrection(data, factorSD)</strong></p>
<p>outlier rejection of data, data is out of factorSD times of standard deviation will be taken as outliers.</p>
<div class="cell" data-execution_count="4">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> outlierCorrection(data, factorSD):</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    element_signal <span class="op">=</span> np.array(data)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    mean <span class="op">=</span> np.mean(element_signal, axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    sd <span class="op">=</span> np.std(element_signal, axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [x <span class="cf">for</span> x <span class="kw">in</span> data <span class="cf">if</span> (x <span class="op">&gt;</span> mean <span class="op">-</span> factorSD <span class="op">*</span> sd) <span class="kw">and</span> (x <span class="op">&lt;</span> mean <span class="op">+</span> factorSD <span class="op">*</span> sd)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><strong>def parseBoronTable(file)</strong></p>
<div class="cell" data-execution_count="5">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> parseBoronTable(<span class="bu">file</span>):</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">#content = file.read()</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    content <span class="op">=</span> <span class="bu">file</span>.getvalue().decode(<span class="st">"utf-8"</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    fname <span class="op">=</span> <span class="bu">file</span>.__dict__[<span class="st">"name"</span>]</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    _start <span class="op">=</span> content.find(<span class="st">"Cycle</span><span class="ch">\t</span><span class="st">Time"</span>)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">#print(_start)</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    _end <span class="op">=</span> content.find(<span class="st">"***</span><span class="ch">\t</span><span class="st">Cup"</span>)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">#print(_end)</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    myTable <span class="op">=</span> content[_start:_end<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">#print(myTable)</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    cleanFname <span class="op">=</span><span class="ss">f"temp/</span><span class="sc">{</span>fname<span class="sc">}</span><span class="ss">_cleanTable"</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(cleanFname ,<span class="st">"w"</span>) <span class="im">as</span> _:</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>        _.write(myTable)</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.read_csv(cleanFname, </span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>                     sep<span class="op">=</span><span class="st">'</span><span class="ch">\t</span><span class="st">'</span>, </span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>                     <span class="co">#dtype="float"   #not working --&gt;time</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>                     )</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df, fname</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><strong>def bacground_sub(folder, select_line, factorSD, factor_B11)</strong></p>
<p>background subtraction. Folder contains all datafiles that need to be calculated. For 10B data, values above select_line will be considered as signal, and values below is taken as noise. The same noise and signal interval will apply to ‘9.9’, ’10.2’ and ‘11B’. So, noise in different cups will be subtracted. Then, the average value of ‘9.9’ and ’10.2’ will be used for additional background subtraction for each row of 10B, factor_B11 times the average value of ‘9.9’ and ’10.2’ will be taken as additional background subtraction for 11B. The last step is calculating the average of 11B/10B, results is out of factorSD times of standard deviation will be taken as outliers. the average of 11B/10B, standard deviation and name of datafile will be returned.</p>
<div class="cell" data-execution_count="6">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> bacground_sub(select_line, factorSD, factor_B11):</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">#fNames_tmp = sorted(st.session_state.fNames)</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    average_B <span class="op">=</span> []</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> st.session_state.uploaded_files:</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>        <span class="co">#read data</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>        <span class="co">#filename = fNames_tmp[i]</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>        <span class="co">#df = pd.read_csv(uploaded_files[i].read())</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>        df_data, filename <span class="op">=</span> parseBoronTable(i)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>        <span class="co">#print(df)</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>        <span class="co">#read all data rows and select useful columns</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">#     fil = df['10B'].str.contains('L|IC|C|H') == True</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">#     endnum = df['10B'][fil].index[0]</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>        df_data <span class="op">=</span> df_data[[<span class="st">'9.9'</span>, <span class="st">'10B'</span>, <span class="st">'10.2'</span>, <span class="st">'11B'</span>]].astype(<span class="bu">float</span>)</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>         <span class="co">#seperate two dataframe based on selectline, one is background, one is signal </span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>        index_select <span class="op">=</span> df_data[<span class="st">'10B'</span>] <span class="op">&gt;=</span> select_line</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>        df_bacground_mean <span class="op">=</span> df_data[<span class="op">~</span>index_select].mean()</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>        df_signal <span class="op">=</span> df_data.loc[index_select]</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">#         #substract background, substract bulc for 10B and 11B</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>        df_bacground_sub <span class="op">=</span> df_signal <span class="op">-</span> df_bacground_mean</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>        df_bacground_sub[<span class="st">'10B_bulc_sub'</span>] <span class="op">=</span> df_bacground_sub[<span class="st">'10B'</span>]<span class="op">-</span>(df_bacground_sub[<span class="st">'9.9'</span>]<span class="op">+</span>df_bacground_sub[<span class="st">'10.2'</span>])<span class="op">/</span><span class="dv">2</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>        df_bacground_sub[<span class="st">'11B_bulc_sub'</span>] <span class="op">=</span> df_bacground_sub[<span class="st">'11B'</span>]<span class="op">-</span>factor_B11<span class="op">*</span>(df_bacground_sub[<span class="st">'9.9'</span>]<span class="op">+</span>df_bacground_sub[<span class="st">'10.2'</span>])<span class="op">/</span><span class="dv">2</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>        df_bacground_sub[<span class="st">'11B/10B'</span>] <span class="op">=</span> df_bacground_sub[<span class="st">'11B_bulc_sub'</span>]<span class="op">/</span>df_bacground_sub[<span class="st">'10B_bulc_sub'</span>] </span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>        res_iso <span class="op">=</span> outlierCorrection(df_bacground_sub[<span class="st">'11B/10B'</span>], factorSD)</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>        res_11B <span class="op">=</span> outlierCorrection(df_bacground_sub[<span class="st">'11B'</span>], factorSD)</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>        average_B.append({<span class="st">'filename'</span>: filename, <span class="st">'11B'</span>: np.mean(res_11B), <span class="st">'11B/10B_row'</span>: np.mean(res_iso), <span class="st">'se'</span>: np.std(res_iso)<span class="op">/</span>np.sqrt(<span class="bu">len</span>(res_iso))})</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.DataFrame(average_B)</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>    st.session_state.average_B <span class="op">=</span> df</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><strong>def polynomFit(inp, *args)</strong></p>
<p>used for regression function.</p>
<div class="cell" data-execution_count="7">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> polynomFit(inp, <span class="op">*</span>args):</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span>inp</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    res<span class="op">=</span><span class="dv">0</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> order <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(args)):</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>        res<span class="op">+=</span>args[order] <span class="op">*</span> x<span class="op">**</span>order</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> res</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><strong>def regression(x, y, ref_stand, order, listname)</strong></p>
<p>get the correction of the Intra-sequence Instrumental drift. x is the list of standard sample’s sequence number, and y is the calculated average 11B/10B of standard sample from bacground_sub function. ref_stand is the reference 11B/10B value of standard. Order is the level of poly regression function. Listname is the sequence number list of all datafiles. O</p>
<div class="cell" data-execution_count="8">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> regression(x, y, ref_stand, order, listname):</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    x_use <span class="op">=</span> np.array(x)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    popt, pcov <span class="op">=</span> curve_fit(polynomFit, xdata<span class="op">=</span>x_use, ydata<span class="op">=</span>y , p0<span class="op">=</span>[<span class="dv">0</span>]<span class="op">*</span>(order<span class="op">+</span><span class="dv">1</span>))</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    fitData<span class="op">=</span>polynomFit(x_use,<span class="op">*</span>popt)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    res <span class="op">=</span> []</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> unknown <span class="kw">in</span> listname:</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>        y_unknown <span class="op">=</span> ref_stand <span class="op">/</span> polynomFit(unknown,<span class="op">*</span>popt)</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>        res.append({<span class="st">'factor'</span>: y_unknown})</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span>(pd.DataFrame(res))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><strong>def regression(x, y, ref_stand, order, listname)</strong></p>
<div class="cell" data-execution_count="9">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> regression_plot(x, y, ref_stand, order, listname):</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    ax.plot(x, y, label<span class="op">=</span><span class="st">'measuered'</span>, marker<span class="op">=</span><span class="st">'o'</span>, linestyle<span class="op">=</span><span class="st">'none'</span> )</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    x_use <span class="op">=</span> np.array(x)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    popt, pcov <span class="op">=</span> curve_fit(polynomFit, xdata<span class="op">=</span>x_use, ydata<span class="op">=</span>y , p0<span class="op">=</span>[<span class="dv">0</span>]<span class="op">*</span>(order<span class="op">+</span><span class="dv">1</span>))</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    fitData<span class="op">=</span>polynomFit(x_use,<span class="op">*</span>popt)</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    ax.plot(x_use, fitData, label<span class="op">=</span><span class="st">'polyn. fit, order '</span><span class="op">+</span><span class="bu">str</span>(order), linestyle<span class="op">=</span><span class="st">'--'</span> )</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    ax.legend(loc<span class="op">=</span><span class="st">'upper left'</span>, bbox_to_anchor<span class="op">=</span>(<span class="fl">1.05</span>, <span class="dv">1</span>))</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> fig</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><strong>def prepare_trace(datafile)</strong></p>
<p>delete useless information from all columns titles and change the data format to float.</p>
<div class="cell" data-execution_count="10">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> prepare_trace(datafile):</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">'LR'</span> <span class="kw">in</span> datafile.columns[<span class="dv">14</span>]:</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>        <span class="kw">del</span> datafile[<span class="st">'44Ca(LR)'</span>]</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>        <span class="kw">del</span> datafile[<span class="st">'26Mg(LR)'</span>]</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>        <span class="kw">del</span> datafile[<span class="st">'44Ca'</span>]</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>        <span class="kw">del</span> datafile[<span class="st">'26Mg'</span>]</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    datafile.columns <span class="op">=</span> datafile.columns.<span class="bu">str</span>.replace(<span class="st">'\d+'</span>, <span class="st">''</span>)</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    datafile.columns <span class="op">=</span> datafile.columns.<span class="bu">str</span>.replace(<span class="st">'\('</span><span class="op">+</span><span class="st">'LR'</span><span class="op">+</span><span class="st">'\)'</span>, <span class="st">''</span>)</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    res <span class="op">=</span> []</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">13</span>, <span class="bu">len</span>(datafile.columns)):</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j <span class="kw">in</span> datafile.iloc[:, i]:</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="st">'&lt;'</span> <span class="kw">in</span> j:</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>                res.append(j)</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>    RES <span class="op">=</span> datafile.replace(to_replace <span class="op">=</span> res, value<span class="op">=</span><span class="st">'nan'</span>, regex<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>    RES2 <span class="op">=</span> RES.replace({<span class="st">'ERROR: Error (#1002): Internal standard composition can not be 0'</span>: np.nan})</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>    RES3 <span class="op">=</span> RES2.replace({<span class="st">'ERROR: Error (#1003): Calibration RM composition does not contain analyte element'</span>: np.nan})</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>    RES4 <span class="op">=</span> RES3.iloc[:, <span class="dv">13</span>:].astype(<span class="bu">float</span>)</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>    columns <span class="op">=</span> RES3.iloc[:, <span class="dv">13</span>:].columns</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>    RES4[columns] <span class="op">=</span> RES3.iloc[:, <span class="dv">13</span>:]</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>    RES4[<span class="st">' Sequence Number'</span>] <span class="op">=</span> RES3[<span class="st">'LB#'</span>]</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span>(RES4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="explaining-the-main-body-of-the-code" class="level3" data-number="4.2">
<h3 data-number="4.2" class="anchored" data-anchor-id="explaining-the-main-body-of-the-code"><span class="header-section-number">4.2</span> Explaining the Main Body of the Code</h3>
</section>
</section>
<section id="explain-the-output" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="explain-the-output"><span class="header-section-number">5</span> Explain the Output</h2>
<p>What exactly is the output, likely best with screen shots.</p>
<p>–&gt;’Sequence Number’ column: the number of datafile in all sequence. –&gt;The ‘Comment’ column: sample name, labelled by yourself when measuring. –&gt; ‘Spot size (um)’, ‘Laser HV (kV)’, ‘Laser Energy (mJ)’: useful information selected from laser parameters. –&gt;The ‘filename’ column: name of datafile. –&gt;from ‘11B’ to ‘factor_iso’: all results from Neptune. ’[B]_corrected’ is calculated B concentrations from 11B. ‘δ11B’ and ‘δ11B_se’column are calculated isotope results and erros. –&gt;from ‘Li’, ‘B’ to ‘U’ are all trace element results from Element XR.</p>
<p>(the following is copied from what was a ‘text’ file.) 1. csv files are changed from original .exp file 2. data automatically from machine can be found in ‘data/original data type’.</p>
</section>
<section id="testing" class="level2" data-number="6">
<h2 data-number="6" class="anchored" data-anchor-id="testing"><span class="header-section-number">6</span> Testing</h2>
<p>For a demonstration of a line plot on a polar axis, see <a href="#fig-polar">Figure&nbsp;1</a>.</p>
<div class="cell" data-execution_count="11">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> np.arange(<span class="dv">0</span>, <span class="dv">2</span>, <span class="fl">0.01</span>)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>theta <span class="op">=</span> <span class="dv">2</span> <span class="op">*</span> np.pi <span class="op">*</span> r</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  subplot_kw <span class="op">=</span> {<span class="st">'projection'</span>: <span class="st">'polar'</span>} </span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>ax.plot(theta, r)</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>ax.set_rticks([<span class="fl">0.5</span>, <span class="dv">1</span>, <span class="fl">1.5</span>, <span class="dv">2</span>])</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>ax.grid(<span class="va">True</span>)</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-polar" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="Boron_Documentation_files/figure-html/fig-polar-output-1.png" width="442" height="432" class="figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;1: A line plot on a polar axis</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>